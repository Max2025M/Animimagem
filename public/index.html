<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image â†’ Video Camera Preview</title>

<style>
body{margin:0;background:#111;color:#fff;font-family:Arial,Helvetica,sans-serif;display:flex;justify-content:center;min-height:100vh;}
.app{width:100%;max-width:1100px;padding:20px;}
.block{border-top:2px solid #333;padding-top:20px;margin-top:20px;}
.controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-bottom:15px;}
select,input,button{padding:10px;border-radius:8px;border:none;}
button{background:#00e0ff;font-weight:bold;cursor:pointer;}
.preview{display:flex;justify-content:center;}
.frame{position:relative;width:80vw;max-width:800px;aspect-ratio:16/9;background:#000;border:3px solid #fff;overflow:hidden;}
.frame img{position:absolute;will-change:transform;}
.progress{margin-top:10px;}
video{width:100%;margin-top:10px;display:none;}
</style>
</head>

<body>
<div class="app">
<h2>ðŸŽ¥ AnimaÃ§Ã£o de CÃ¢mera (Preview)</h2>

<input type="file" id="upload" accept="image/*">

<div class="block">
  <div class="preview">
    <div class="frame"><img id="img"></div>
  </div>

  <div class="controls">
    <button id="render">Gerar vÃ­deo no Render</button>
  </div>

  <div class="progress" id="progress"></div>
  <video id="video" controls></video>
</div>
</div>

<script>
const img = document.getElementById('img');
const upload = document.getElementById('upload');
const progress = document.getElementById('progress');
const video = document.getElementById('video');

upload.onchange = e => {
  img.src = URL.createObjectURL(e.target.files[0]);
};

document.getElementById('render').onclick = async () => {
  const file = upload.files[0];
  if (!file) return alert('Selecione uma imagem');

  const fd = new FormData();
  fd.append('image', file);

  const res = await fetch('/render', { method:'POST', body:fd });
  const { id } = await res.json();

  const timer = setInterval(async () => {
    const p = await fetch(`/progress/${id}`).then(r=>r.json());
    progress.innerText = `Renderizando: ${p.progress || 0}%`;

    if (p.done) {
      clearInterval(timer);
      progress.innerText = 'Finalizado!';
      video.src = p.url;
      video.style.display = 'block';
    }
  }, 1000);
};
</script>
</body>
</html>
